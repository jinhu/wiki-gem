/*! wiki-client - v0.1.6 - 2014-04-17 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){window.wiki=a("./lib/wiki"),a("./lib/legacy")},{"./lib/legacy":6,"./lib/wiki":20}],2:[function(a,b){var c,d,e;b.exports=c={},c.scrollContainer=void 0,d=function(){var a;return a=$("body, html").filter(function(){return $(this).scrollLeft()>0}),a.length>0?a:$("body, html").scrollLeft(12).filter(function(){return $(this).scrollLeft()>0}).scrollTop(0)},e=function(a){var b,e,f,g,h,i;if(null!=a.position())return null==c.scrollContainer&&(c.scrollContainer=d()),b=$("body").width(),g=c.scrollContainer.scrollLeft(),f=g+b,h=a.position().left,i=a.outerWidth(!0),e=$(".page").outerWidth(!0)*$(".page").size(),g>h?c.scrollContainer.animate({scrollLeft:h}):h+i>f?c.scrollContainer.animate({scrollLeft:h-(b-i)}):f>$(".pages").outerWidth()?c.scrollContainer.animate({scrollLeft:Math.min(h,e-b)}):void 0},c.set=function(a){return a=$(a),$(".active").removeClass("active"),e(a.addClass("active"))}},{}],3:[function(a,b){var c;c=a("./util"),b.exports=function(a,b){var d,e,f,g;return g=a.parents(".page:first"),e=b.type||"separator",null!=b.date&&(e+=" "+c.formatElapsedTime(b.date)),d=$('<a href="#" /> ').addClass("action").addClass(b.type||"separator").text(b.symbol||c.symbols[b.type]).attr("title",e).attr("data-id",b.id||"0").data("action",b),f=a.children(".control-buttons"),f.length>0?d.insertBefore(f):d.appendTo(a),"fork"===b.type&&null!=b.site?d.css("background-image","url(//"+b.site+"/favicon.png)").attr("href","//"+b.site+"/"+g.attr("id")+".html").data("site",b.site).data("slug",g.attr("id")):void 0}},{"./util":19}],4:[function(a,b){var c,d,e,f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=function(a,b){var c;return null==(c=a.originalEvent.dataTransfer)||null==c.types||!(f.call(c.types,"text/uri-list")>=0||f.call(c.types,"text/x-moz-url")>=0)||f.call(c.types,"Files")>=0?void 0:b(c.getData("URL"))},d=function(a,b){var c,d,e,f,g;return(c=a.match(/^http:\/\/([a-zA-Z0-9:.-]+)(\/([a-zA-Z0-9:.-]+)\/([a-z0-9-]+(_rev\d+)?))+$/))?(e={},d=c[0],f=c[1],d=c[2],e.site=c[3],e.slug=c[4],d=c[5],("view"===(g=e.site)||"local"===g||"origin"===g)&&(e.site=f),b(e)):void 0},c=function(a){return function(b){return e(b,function(c){return d(c,function(c){return null!=a.page?(b.preventDefault(),a.page(c)):void 0})})}},b.exports={dispatch:c}},{}],5:[function(a,b){var c,d,e,f,g=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};f=function(a,b){var c,d;return a.append("<p>Double-Click to Edit<br>Drop Text or Image to Insert</p>"),c=function(){var c,d,e,f,g,h,i,j,k;if(e=a.find("p").append("<br>Or Choose a Plugin"),e.append(d=$('<div style="text-align:left; padding-left: 40%"></div>')),e=d,f=function(a,b){return e.append('<li><a class="menu" href="#" title="'+a+'">'+b+"</a></li>")},Array.isArray(window.catalog))for(j=window.catalog,h=0,i=j.length;i>h;h++)c=j[h],f(c.title,c.name);else{k=window.catalog;for(g in k)c=k[g],f(c.menu,g)}return e.find("a.menu").click(function(c){return a.removeClass("factory").addClass(b.type=c.target.text.toLowerCase()),a.unbind(),wiki.textEditor(a,b)})},d=function(){return a.append("<p>"+wiki.resolveLinks(b.prompt)+"</b>")},b.prompt?d():null!=window.catalog?c():$.getJSON("/system/factories.json",function(a){return window.catalog=a,c()})},d=function(a,b){var d;return d=function(){var c,d;wiki.log("factory item",b),a.empty().unbind(),a.removeClass("factory").addClass(b.type),d=a.parents(".page:first");try{a.data("pageElement",d),a.data("item",b),wiki.getPlugin(b.type,function(c){return c.emit(a,b),c.bind(a,b)})}catch(e){c=e,a.append("<p class='error'>"+c+"</p>")}return wiki.pageHandler.put(d,{type:"edit",id:b.id,item:b})},a.dblclick(function(){return a.removeClass("factory").addClass(b.type="paragraph"),a.unbind(),wiki.textEditor(a,b)}),a.bind("dragenter",function(a){return a.preventDefault()}),a.bind("dragover",function(a){return a.preventDefault()}),a.bind("drop",function(a){var f,h,i,j,k,l,m;return k=function(c){return b.prompt="<b>Unexpected Item</b><br>We can't make sense of the drop.<br>"+JSON.stringify(c)+"<br>Try something else or see [[About Factory Plugin]].",c.userAgent=navigator.userAgent,b.punt=c,wiki.log("factory punt",a),d()},l=function(f){var g,h,i,j;return null!=f?(j=f.type.split("/"),g=j[0],h=j[1],i=new FileReader,"image"===g?(i.onload=function(a){return b.type="image",b.url=a.target.result,b.caption||(b.caption="Uploaded image"),d()},i.readAsDataURL(f)):"text"===g?(i.onload=function(a){var g,i;return i=a.target.result,"csv"===h?(b.type="data",b.columns=(g=e(i))[0],b.data=c(g),b.text=f.fileName):(b.type="paragraph",b.text=i),d()},i.readAsText(f)):k({number:1,name:f.fileName,type:f.type})):k({number:2,types:a.originalEvent.dataTransfer.types})},a.preventDefault(),a.stopPropagation(),null!=(f=a.originalEvent.dataTransfer)?null==f.types||!(g.call(f.types,"text/uri-list")>=0||g.call(f.types,"text/x-moz-url")>=0)||g.call(f.types,"Files")>=0?g.call(f.types,"Files")>=0?l(f.files[0]):k({number:5,types:f.types}):(m=f.getData("URL"),(h=m.match(/^http:\/\/([a-zA-Z0-9:.-]+)(\/([a-zA-Z0-9:.-]+)\/([a-z0-9-]+(_rev\d+)?))+$/))?(wiki.log("factory drop url",h),i=h[0],j=h[1],i=h[2],b.site=h[3],b.slug=h[4],i=h[5],$.inArray(b.site,["view","local","origin"])>=0&&(b.site=j),$.getJSON("http://"+b.site+"/"+b.slug+".json",function(a){return wiki.log("factory remote",a),b.type="reference",b.title=a.title||b.slug,b.text=wiki.createSynopsis(a),d(),null!=b.site?wiki.registerNeighbor(b.site):void 0})):k({number:4,url:m,types:f.types})):k({number:6,trouble:"no data transfer object"})})},e=function(a,b){var c,d,e,f,g;for(b=b||",",e=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),c=[[]],d=null;d=e.exec(a);)f=d[1],f.length&&f!==b&&c.push([]),g=d[2]?d[2].replace(new RegExp('""',"g"),'"'):d[3],c[c.length-1].push(g);return c},c=function(a){var b,c,d,e,f,g;for(b=a.shift(),d=function(a){var c,d,e,f,g,h,i;for(d={},h=_.zip(b,a),f=0,g=h.length;g>f;f++)i=h[f],c=i[0],e=i[1],null!=e&&e.match(/\S/)&&"NULL"!==e&&(d[c]=e);return d},g=[],e=0,f=a.length;f>e;e++)c=a[e],g.push(d(c));return g},b.exports={emit:f,bind:d}},{}],6:[function(a){var b,c,d,e,f,g,h,i,j,k;k=a("./wiki"),j=a("./util"),f=k.pageHandler=a("./pageHandler"),g=a("./plugin"),i=a("./state"),b=a("./active"),h=a("./refresh"),e=a("./page").newPage,d=a("./lineup"),c=a("./drop"),$(function(){var a,e,l,m,n,o,p,q;return window.dialog=$("<div></div>").html("This dialog will show every time!").dialog({autoOpen:!1,title:"Basic Dialog",height:600,width:800}),k.dialog=function(a,b){return window.dialog.html(b),window.dialog.dialog("option","title",k.resolveLinks(a)),window.dialog.dialog("open")},p=function(a,b){return setTimeout(b,a)},k.removeItem=function(a,b){return f.put(a.parents(".page:first"),{type:"remove",id:b.id}),a.remove()},k.createItem=function(a,b,c){var d,e;return null==a&&(a=b.parents(".page")),c.id=j.randomBytes(8),d=$('<div class="item '+c.type+'" data-id=""</div>'),d.data("item",c).data("pageElement",a),null!=b?b.after(d):a.find(".story").append(d),g["do"](d,c),e=k.getItem(b),p(500,function(){return f.put(a,{item:c,id:c.id,type:"add",after:null!=e?e.id:void 0})}),d},l=function(a,b,c){var d,e,h;return d={type:"paragraph",id:j.randomBytes(8),text:c},h=$('<div class="item paragraph" data-id='+d.id+"></div>"),h.data("item",d).data("pageElement",a),b.after(h),g["do"](h,d),e=k.getItem(b),k.textEditor(h,d),p(500,function(){return f.put(a,{item:d,id:d.id,type:"add",after:null!=e?e.id:void 0})})},q=k.textEditor=function(a,b,c,d){var e,h,i;if(!a.hasClass("textEditing"))return a.addClass("textEditing"),h=$("<textarea>"+(e=null!=(i=b.text)?i:"")+"</textarea>").focusout(function(){if(a.removeClass("textEditing"),b.text=h.val()){if(g["do"](a.empty(),b),b.text===e)return;f.put(a.parents(".page:first"),{type:"edit",id:b.id,item:b})}else f.put(a.parents(".page:first"),{type:"remove",id:b.id}),a.remove();return null}).bind("keydown",function(c){var d,e,f,g,i,n,o,p,r;if((c.altKey||c.ctlKey||c.metaKey)&&83===c.which)return h.focusout(),!1;if((c.altKey||c.ctlKey||c.metaKey)&&73===c.which)return c.preventDefault(),c.shiftKey||(e=$(c.target).parents(".page")),m("about "+b.type+" plugin",e),!1;if("paragraph"===b.type){if(o=j.getSelectionPos(h),c.which===$.ui.keyCode.BACKSPACE&&0===o.start&&o.start===o.end)return i=k.getItem(a.prev()),"paragraph"!==i.type?!1:(n=i.text.length,i.text+=h.val(),h.val(""),q(a.prev(),i,n),!1);if(c.which===$.ui.keyCode.ENTER&&"paragraph"===b.type)return o?(r=h.val(),g=r.substring(0,o.start),o.start!==o.end&&(d=r.substring(o.start,o.end)),p=r.substring(o.end),h.val(""===g?" ":g),h.focusout(),f=a.parent().parent(),l(f,a,p),null!=d&&l(f,a,d),""===g&&l(f,a,""),!1):!1}}),a.html(h),null!=c?j.setCaretPosition(h,c):d?(j.setCaretPosition(h,h.val().length),h.scrollTop(h[0].scrollHeight-h.height())):h.focus()},m=k.doInternalLink=function(a,c,e){return null==e&&(e=null),a=k.asSlug(a),null!=c&&$(c).nextAll().remove(),null!=c&&d.removeAllAfterKey($(c).data("key")),k.createPage(a,e).appendTo($(".main")).each(h),b.set($(".page").last())},a=37,e=39,$(document).keydown(function(c){var d,f,g;return d=function(){switch(c.which){case a:return-1;case e:return 1}}(),d&&"TEXTAREA"!==c.target.tagName&&(g=$(".page"),f=g.index($(".active"))+d,f>=0&&f<g.length)?b.set(g.eq(f)):void 0}),$(window).on("popstate",i.show),$(document).ajaxError(function(a,b,c){return 0!==b.status&&404!==b.status?k.log("ajax error",a,b,c):void 0}),o=function(a,b){return a?(k.log("getTemplate",a),f.get({whenGotten:function(a){return b(a)},whenNotGotten:function(){return b(null)},pageInformation:{slug:a}})):b(null)},n=function(a,b){var c;return a.preventDefault(),a.shiftKey||(c=$(a.target).parents(".page")),m(b,c,$(a.target).data("site")),!1},$(".main").delegate(".show-page-source","click",function(a){var b,c;return a.preventDefault(),c=$(this).parent().parent(),b=c.data("data"),k.dialog("JSON for "+b.title,$("<pre/>").text(JSON.stringify(b,null,2)))}).delegate(".page","click",function(a){return $(a.target).is("a")?void 0:b.set(this)}).delegate(".internal","click",function(a){var b;return b=$(a.target).data("pageName"),b=""+b,f.context=$(a.target).attr("title").split(" => "),n(a,b)}).delegate("img.remote","click",function(a){var b;return b=$(a.target).data("slug"),f.context=[$(a.target).data("site")],n(a,b)}).delegate(".revision","dblclick",function(a){var b,c,d,e,f;return a.preventDefault(),b=$(this).parents(".page"),e=b.data("data"),f=e.journal.length-1,c=e.journal[f],d=JSON.stringify(c,null,2),k.dialog("Revision "+f+", "+c.type+" action",$("<pre/>").text(d))}).delegate(".action","click",function(a){var c,e,g,i,j;return a.preventDefault(),c=$(a.target),c.is(".fork")&&null!=(g=c.data("slug"))?(f.context=[c.data("site")],n(a,g.split("_")[0])):(e=$(this).parents(".page"),j=k.asSlug(e.data("data").title),i=$(this).parent().children().not(".separator").index(c),0>i?void 0:(a.shiftKey||e.nextAll().remove(),a.shiftKey||d.removeAllAfterKey(e.data("key")),k.createPage(""+j+"_rev"+i,e.data("site")).appendTo($(".main")).each(h),b.set($(".page").last())))}).delegate(".fork-page","click",function(a){var b,c,d;if(c=$(a.target).parents(".page"),c.hasClass("local")){if(!k.useLocalStorage())return b=c.data("data"),c.removeClass("local"),f.put(c,{type:"fork",item:b})}else if(null!=(d=c.data("site")))return f.put(c,{type:"fork",site:d})}).delegate(".action","hover",function(){var a;return a=$(this).attr("data-id"),$("[data-id="+a+"]").toggleClass("target"),$(".main").trigger("rev")}).delegate(".item","hover",function(){var a;return a=$(this).attr("data-id"),$(".action[data-id="+a+"]").toggleClass("target")}).delegate("button.create","click",function(a){return o($(a.target).data("slug"),function(b){var c,e,g;return c=$(a.target).parents(".page:first"),c.removeClass("ghost"),g=d.atKey(c.data("key")),g.become(b),e=g.getRawPage(),f.put(c,{type:"create",id:e.id,item:{title:e.title,story:e.story}}),k.rebuildPage(g,c.empty())})}).delegate(".ghost","rev",function(a){var b,c,d;return k.log("rev",a),c=$(a.target).parents(".page:first"),b=c.find(".target"),d=b.offset().top+c.scrollTop()-c.height()/2,k.log("scroll",c,b,d),c.stop().animate({scrollTop:postion},"slow")}).delegate(".score","hover",function(a){return $(".main").trigger("thumb",$(a.target).data("thumb"))}).bind("dragenter",function(a){return a.preventDefault()}).bind("dragover",function(a){return a.preventDefault()}).bind("drop",c.dispatch({page:function(a){return m(a.slug,null,a.site)}})),$(".provider input").click(function(){return $("footer input:first").val($(this).attr("data-provider")),$("footer form").submit()}),$("body").on("new-neighbor-done",function(){return $(".page").each(function(a,b){return k.emitTwins($(b))})}),$(function(){return i.first(),$(".page").each(h),b.set($(".page").last())})})},{"./active":2,"./drop":4,"./lineup":7,"./page":9,"./pageHandler":10,"./plugin":12,"./refresh":14,"./state":17,"./util":19,"./wiki":20}],7:[function(a,b){var c,d,e,f,g,h,i,j,k,l=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};k=a("./util"),h={},g=[],c=function(a){var b;return b=k.randomBytes(4),h[b]=a,g.push(b),b},j=function(a){return l.call(g,a)<0?null:(g=g.filter(function(b){return a!==b}),delete h[a],a)},i=function(a){var b,c;if(b=[],l.call(g,a)<0)return b;for(;g[g.length-1]!==a;)c=g.pop(),b.unshift(c),delete h[c];return b},d=function(a){return h[a]},e=function(){return g},f=function(){return h={},g=[]},b.exports={addPage:c,removeKey:j,removeAllAfterKey:i,atKey:d,debugKeys:e,debugReset:f}},{"./util":19}],8:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m={}.hasOwnProperty;l=a("underscore"),k=a("./wiki"),c=a("./active"),j=a("./util"),d=a("./search"),b.exports=e={},null==k.neighborhood&&(k.neighborhood={}),f=0,g=2e3,i=0,h=function(a,b){var c,d,e;if(!b.sitemapRequestInflight)return b.sitemapRequestInflight=!0,e=function(a,b,c){return $('.neighbor[data-site="'+a+'"]').find("div").removeClass(b).addClass(c)},c=function(){var c,d;return d="http://"+a+"/system/sitemap.json",e(a,"wait","fetch"),c=$.ajax({type:"GET",dataType:"json",url:d}),c.always(function(){return b.sitemapRequestInflight=!1}).done(function(c){return b.sitemap=c,e(a,"fetch","done"),$("body").trigger("new-neighbor-done",a)}).fail(function(){return e(a,"fetch","fail")})},d=Date.now(),d>f?(f=d+g,setTimeout(c,100)):(setTimeout(c,f-d),f+=g)},k.registerNeighbor=e.registerNeighbor=function(a){var b;if(null==k.neighborhood[a])return b={},k.neighborhood[a]=b,h(a,b),$("body").trigger("new-neighbor",a)},e.listNeighbors=function(){return l.keys(k.neighborhood)},e.search=function(a){var b,c,d,e,f,g,h,i,j,n;b=[],i={},j=function(a){return null!=i[a]?i[a]++:i[a]=1},c=function(b,c){var d;return d=null!=c&&c.toLowerCase().indexOf(a.toLowerCase())>=0,d&&j(b),d},h=Date.now(),n=k.neighborhood;for(f in n)m.call(n,f)&&(e=n[f],g=e.sitemap,null!=g&&j("sites"),d=l.each(g,function(a){return j("pages"),c("title",a.title)||c("text",a.synopsis)||c("slug",a.slug)?(j("finds"),b.push({page:a,site:f,rank:1})):void 0}));return i.msec=Date.now()-h,{finds:b,tally:i}},$(function(){var a,b,c;return a=$(".neighborhood"),b=function(a){return'<span class="neighbor" data-site="'+a+'">\n  <div class="wait">\n    <img src="http://'+a+'/favicon.png" title="'+a+'">\n  </div>\n</span>'},$("body").on("new-neighbor",function(c,d){return a.append(b(d))}).on("new-neighbor-done",function(a,b){var c,d;return d=k.neighborhood[b].sitemap.length,c=$('.neighborhood .neighbor[data-site="'+b+'"]').find("img"),c.attr("title",""+b+"\n "+d+" pages"),i+=d,$(".searchbox .pages").text(""+i+" pages")}).delegate(".neighbor img","click",function(){return k.doInternalLink("welcome-visitors",null,this.title.split("\n")[0])}),c=d({neighborhood:e}),$("input.search").on("keypress",function(a){var b;if(13===a.keyCode)return b=$(this).val(),c.performSearch(b),$(this).val("")})})},{"./active":2,"./search":16,"./util":19,"./wiki":20,underscore:21}],9:[function(a,b){var c,d,e,f,g;f=a("./util"),g=a("underscore"),c=function(a){return a.replace(/\s/g,"-").replace(/[^A-Za-z0-9-]/g,"").toLowerCase()},e=function(a){return[{symbol:"❄",date:a-316224e5,period:"a Year"},{symbol:"⚘",date:a-80352e5,period:"a Season"},{symbol:"⚪",date:a-26784e5,period:"a Month"},{symbol:"☽",date:a-6048e5,period:"a Week"},{symbol:"☀",date:a-864e5,period:"a Day"},{symbol:"⌚",date:a-36e5,period:"an Hour"}]},d=function(a,b){var d,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;return v=a||{},v.title||(v.title="empty"),v.story||(v.story=[]),v.journal||(v.journal=[]),l=function(){return v},j=function(){var a,c,d,e,f,h;for(d=["view"],u()&&d.push(b),c=function(a){return null==a||g.include(d,a)?void 0:d.push(a)},h=v.journal.slice(0).reverse(),e=0,f=h.length;f>e;e++)a=h[e],c(a.site);return d},t=function(){return null!=v.plugin},u=function(){return!(void 0===b||null===b||"view"===b||"origin"===b||"local"===b)},s=function(){return"local"===b},m=function(a){return null==a&&(a=null),u()?b:a},n=function(a){var b;return null==a&&(a=null),b=[],(a||u())&&b.push(m(a)),t()&&b.push(""+v.plugin+" plugin"),b.join("\n")},p=function(){return c(v.title)},k=function(a){var c,d,e,f,h,i,j,k,l;for(e=[],u()?e.push(b):null!=a&&e.push(a),k=v.story,f=0,i=k.length;i>f;f++)d=k[f],null!=d.site&&e.push(d.site);for(l=v.journal,h=0,j=l.length;j>h;h++)c=l[h],null!=c.site&&e.push(c.site);return g.uniq(e)},r=function(){return v.title},y=function(a){return v.title=a},o=function(){return v.journal.length-1},q=function(){var a;return a=v.journal[o()].date,null!=a?f.formatDate(a):"Revision "+o()},d=function(a){return a=g.extend({},{id:f.randomBytes(8)},a),v.story.push(a)},x=function(a){var b;return(b=function(c){return c>=v.story.length?void 0:a(v.story[c],function(){return b(c+1)})})(0)},h=function(a){var b;return b="paragraph",d({type:b,text:a})},w=function(a){var b,c,d;return d=0,c=e((new Date).getTime()),(b=function(e){var f,g,h,i,j,k;if(!(e>=v.journal.length)){for(f=v.journal[e],g=f.date||0,i=null,j=0,k=c.length;k>j;j++)h=c[j],h.date>d&&h.date<g&&(i=h);return d=g,a({action:f,separator:i},function(){return b(e+1)})}})(0)},i=function(a){return v.story=(null!=a?a.getRawPage().story:void 0)||[]},{getRawPage:l,getContext:j,isPlugin:t,isRemote:u,isLocal:s,getRemoteSite:m,getRemoteSiteDetails:n,getSlug:p,getNeighbors:k,getTitle:r,setTitle:y,getRevision:o,getTimestamp:q,addItem:d,addParagraph:h,seqItems:x,seqActions:w,become:i}},b.exports={newPage:d}},{"./util":19,underscore:21}],10:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;n=a("underscore"),m=a("./wiki"),l=a("./util"),k=a("./state"),j=a("./revision"),c=a("./addToJournal"),d=a("./page").newPage,b.exports=f={},e=function(a){var b;return(b=localStorage[a])?JSON.parse(b):void 0},i=function(a){var b,c,f,g,h,k,n,o,p;if(f=a.pageInformation,o=a.whenGotten,p=a.whenNotGotten,b=a.localContext,k=f.slug,g=f.rev,h=f.site,h?b=[]:h=b.shift(),h===window.location.host&&(h="origin"),"view"===h&&(h=null),null!=h){if("local"===h)return(c=e(f.slug))?o(d(c,"local")):p();n="origin"===h?"/"+k+".json":"http://"+h+"/"+k+".json"}else n="/"+k+".json";return $.ajax({type:"GET",dataType:"json",url:n+("?random="+l.randomBytes(4)),success:function(a){return g&&(a=j.create(g,a)),o(d(a,h))},error:function(a,c,e){var g;return 404!==a.status&&0!==a.status?(m.log("pageHandler.get error",a,a.status,c,e),g=d({title:"Trouble: Can't Get Page"},null),g.addParagraph("The page handler has run into problems with this   request.\n<pre class=error>"+JSON.stringify(f)+"</pre>\nThe requested url.\n<pre class=error>"+n+"</pre>\nThe server reported status.\n<pre class=error>"+a.status+"</pre>\nThe error type.\n<pre class=error>"+c+"</pre>\nThe error message.\n<pre class=error>"+e+"</pre>\nThese problems are rarely solved by reporting issues.\nThere could be additional information reported in the browser's console.log.\nMore information might be accessible by fetching the page outside of wiki.\n<a href=\""+n+'" target="_blank">try-now</a>'),o(g)):b.length>0?i({pageInformation:f,whenGotten:o,whenNotGotten:p,localContext:b}):p()}})},f.get=function(a){var b,c,g,h;return g=a.whenGotten,h=a.whenNotGotten,c=a.pageInformation,!c.site&&(b=e(c.slug))?(c.rev&&(b=j.create(c.rev,b)),g(d(b,"local"))):(f.context.length||(f.context=["view"]),i({pageInformation:c,whenGotten:g,whenNotGotten:h,localContext:n.clone(f.context)}))},f.context=[],g=function(a,b,d){var f,g;return"create"===d.type?f={title:d.item.title,story:[],journal:[]}:(f=e(b.slug),f||(f=a.data("data")),null==f.journal&&(f.journal=[]),null!=(g=d.fork)&&(f.journal=f.journal.concat({type:"fork",site:g}),delete d.fork),f.story=$(a).find(".item").map(function(){return $(this).data("item")}).get()),f.journal=f.journal.concat(d),localStorage[b.slug]=JSON.stringify(f),c(a.find(".journal"),d)},h=function(a,b,d){return $.ajax({type:"PUT",url:"/page/"+b.slug+"/action",data:{action:JSON.stringify(d)},success:function(){return c(a.find(".journal"),d),"fork"===d.type?localStorage.removeItem(a.attr("id")):void 0},error:function(a,b,c){return m.log("pageHandler.put ajax error callback",b,c)}})},f.put=function(a,b){var d,e,f;return d=function(){var b;switch(b=a.data("site")){case"origin":case"local":case"view":return null;case location.host:return null;default:return b}},f={slug:a.attr("id").split("_rev")[0],rev:a.attr("id").split("_rev")[1],site:d(),local:a.hasClass("local")},e=f.site,m.log("pageHandler.put",b,f),m.useLocalStorage()&&(null!=f.site?m.log("remote => local"):f.local||(m.log("origin => local"),b.site=e=location.host)),b.date=(new Date).getTime(),"origin"===b.site&&delete b.site,e&&(a.find("h1 img").attr("src","/favicon.png"),a.find("h1 a").attr("href","/"),a.data("site",null),a.removeClass("remote"),k.setUrl(),"fork"!==b.type&&(b.fork=e,c(a.find(".journal"),{type:"fork",site:e,date:b.date}))),m.useLocalStorage()||"local"===f.site?(g(a,f,b),a.addClass("local")):h(a,f,b)}},{"./addToJournal":3,"./page":9,"./revision":15,"./state":17,"./util":19,"./wiki":20,underscore:21}],11:[function(a,b){b.exports=function(a){var b;return $("#user-email").hide(),$("#persona-login-btn").hide(),$("#persona-logout-btn").hide(),b=function(a){return $("<div></div>").dialog({open:function(){return $(".ui-dialog-titlebar-close").hide()},buttons:{Ok:function(){return $(this).dialog("close"),navigator.id.logout()}},close:function(){return $(this).remove()},resizable:!1,title:"Login Failure",modal:!0}).html(a)},navigator.id.watch({loggedInUser:a,onlogin:function(a){return $.post("/persona_login",{assertion:a},function(a){var c;return a=JSON.parse(a),"okay"===a.status?window.location="/":"wrong-address"===a.status?b("<p>Sign in is currently only available for the site owner.</p>"):"failure"===a.status?(c=/domain mismatch/.test(a.reason)?"<p>It looks as if you are accessing the site using an alternative address.</p><p>Please check that you are using the correct address to access this site.</p>":"<p>Unable to log you in.</p>",b(c)):navigator.id.logout()})},onlogout:function(){return $.post("/persona_logout",function(){return window.location="/"})},onready:function(){return a?($("#persona-login-btn").hide(),$("#persona-logout-btn").show()):($("#persona-login-btn").show(),$("#persona-logout-btn").hide())}}),$("#persona-login-btn").click(function(a){return a.preventDefault(),navigator.id.request({})}),$("#persona-logout-btn").click(function(a){return a.preventDefault(),navigator.id.logout()})}},{}],12:[function(a,b){var c,d,e,f,g,h,i=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};g=a("./util"),h=a("./wiki"),b.exports=e={},c=function(a,b){return b=$.extend(b||{},{dataType:"script",cache:!0,url:a}),$.ajax(b)},f=[],d=h.getScript=function(a,b){return null==b&&(b=function(){}),i.call(f,a)>=0?b():c(a).done(function(){return f.push(a),b()}).fail(function(){return b()})},e.get=h.getPlugin=function(a,b){return window.plugins[a]?b(window.plugins[a]):d("/plugins/"+a+"/"+a+".js",function(){return window.plugins[a]?b(window.plugins[a]):d("/plugins/"+a+".js",function(){return b(window.plugins[a])})})},e["do"]=h.doPlugin=function(a,b,c){var d;return null==c&&(c=function(){}),d=function(b){var c;return c=$("<div />").addClass("error"),c.text(b.toString()),a.append(c)},a.data("pageElement",a.parents(".page")),a.data("item",b),e.get(b.type,function(e){var f;try{if(null==e)throw TypeError("Can't find plugin for '"+b.type+"'");return e.emit.length>2?e.emit(a,b,function(){return e.bind(a,b),c()}):(e.emit(a,b),e.bind(a,b),c())}catch(g){return f=g,h.log("plugin error",f),d(f),c()}})},h.registerPlugin=function(a,b){return window.plugins[a]=b($)},window.plugins={reference:a("./reference"),factory:a("./factory"),paragraph:{emit:function(a,b){var c,d,e,f,g;for(f=b.text.split(/\n\n+/),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.match(/\S/)?a.append("<p>"+h.resolveLinks(c)+"</p>"):void 0);return g},bind:function(a,b){return a.dblclick(function(){return h.textEditor(a,b,null,!0)})}},image:{emit:function(a,b){return b.text||(b.text=b.caption),a.append('<img class=thumbnail src="'+b.url+'"> <p>'+h.resolveLinks(b.text)+"</p>")},bind:function(a,b){return a.dblclick(function(){return h.textEditor(a,b)}),a.find("img").dblclick(function(){return h.dialog(b.text,this)})}},future:{emit:function(a,b){var c,d,e,f,g;if(a.append(""+b.text+'<br><br><button class="create">create</button> new blank page'),null!=(c=h.neighborhood[location.host])&&null!=c.sitemap){for(f=c.sitemap,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(b.slug.match(/-template$/)?a.append('<br><button class="create" data-slug='+b.slug+">create</button> from "+h.resolveLinks("[["+b.title+"]]")):void 0);return g}},bind:function(){}}}},{"./factory":5,"./reference":13,"./util":19,"./wiki":20}],13:[function(a,b){var c,d;d=function(a,b){var c,d;return d=b.slug||"welcome-visitors",c=b.site,wiki.resolveFrom(c,function(){return a.append("<p style='margin-bottom:3px;'>\n  <img class='remote'\n    src='//"+c+"/favicon.png'\n    title='"+c+"'\n    data-site=\""+c+'"\n    data-slug="'+d+'"\n  >\n  '+wiki.resolveLinks("[["+(b.title||d)+"]]")+"\n</p>\n<div>\n  "+wiki.resolveLinks(b.text)+"\n</div>")})},c=function(a,b){return a.dblclick(function(){return wiki.textEditor(a,b)})},b.exports={emit:d,bind:c}},{}],14:[function(a,b){var c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;y=a("underscore"),w=a("./util"),r=a("./pageHandler"),q=a("./page").newPage,s=a("./plugin"),v=a("./state"),p=a("./neighborhood"),c=a("./addToJournal"),x=a("./wiki"),o=a("./lineup"),l=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;return e=b.item,k=x.getItem(e),g=$(this).parents(".page:first"),f=e.data("pageElement"),p=f.data("site"),d=e.parents(".page:first"),j=function(a,b){return a&&b&&a.get(0)===b.get(0)},n=!f||j(f,d),l=!n&&j(g,f),m=!n&&j(g,d),!l||!f.hasClass("ghost")&&f.attr("id")!==d.attr("id")?(h=n?(o=$(this).children().map(function(a,b){return $(b).attr("data-id")}).get(),{type:"move",order:o}):l?(x.log("drag from",f.find("h1").text()),{type:"remove"}):m?(e.data("pageElement",g),c=e.prev(".item"),i=x.getItem(c),{type:"add",item:k,after:null!=i?i.id:void 0}):void 0,h.id=k.id,r.put(g,h)):void 0},n=function(a){var b,c;return c={connectWith:".page .story",placeholder:"item-placeholder",forcePlaceholderSize:!0},b=a.find(".story"),b.sortable(c).on("sortupdate",l)},m=function(a){return a.find(".add-factory").live("click",function(b){return a.hasClass("ghost")?void 0:(b.preventDefault(),d(a))})},d=function(a){var b,c,d,e;return e={type:"factory",id:w.randomBytes(8)},c=$("<div />",{"class":"item factory"}).data("item",e).attr("data-id",e.id),c.data("pageElement",a),a.find(".story").append(c),s["do"](c,e),b=c.prev(".item"),d=x.getItem(b),r.put(a,{item:e,id:e.id,type:"add",after:null!=d?d.id:void 0})},h=function(a,b,c){var d,e,f;return f="welcome-visitors"===c.getSlug()?"":"/view/"+c.getSlug(),d=c.isRemote()?"//"+c.getRemoteSite():"",e=c.getRemoteSiteDetails(location.host),a.append('<h1 title="'+e+'">\n  <a href="'+d+"/view/welcome-visitors"+f+'">\n    <img src="'+d+'/favicon.png" height="32px" class="favicon">\n  </a> '+c.getTitle()+"\n</h1>")},j=function(a,b,c){return b.attr("id").match(/_rev/)?(b.addClass("ghost"),b.data("rev",c.getRevision()),a.append($('<h2 class="revision">\n  <span>\n    '+c.getTimestamp()+"\n  </span>\n</h2>"))):void 0},f=function(a){return a.append('<div class="control-buttons">\n  <a href="#" class="button fork-page" title="fork this page">'+w.symbols.fork+'</a>\n  <a href="#" class="button add-factory" title="add paragraph">'+w.symbols.add+"</a>\n</div>")},g=function(a,b){var c,d;return c=b.getRemoteSite(location.host),d=b.getSlug(),a.append('<a id="license" href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a> .\n<a class="show-page-source" href="/'+d+".json?random="+w.randomBytes(4)+'" title="source">JSON</a> .\n<a href= "//'+c+"/"+d+'.html">'+c+"</a>")},k=x.emitTwins=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(j=a.data("data"),l=a.data("site")||window.location.host,("view"===l||"origin"===l)&&(l=window.location.host),m=x.asSlug(j.title),null!=(b=null!=(r=j.journal)?r.length:void 0)&&null!=(o=null!=(s=j.journal[b-1])?s.date:void 0)){o=1e3*Math.floor(o/1e3),d={newer:[],same:[],older:[]},t=x.neighborhood;for(k in t)if(g=t[k],k!==l&&null!=g.sitemap)for(u=g.sitemap,p=0,q=u.length;q>p;p++)h=u[p],h.slug===m&&(c=h.date>o?d.newer:h.date<o?d.older:d.same,c.push({remoteSite:k,item:h}));n=[];for(i in d)c=d[i],c.length&&(c.sort(function(a,b){return a.item.date<b.item.date}),e=function(){var a,b,d,e;for(e=[],f=a=0,b=c.length;b>a&&(d=c[f],k=d.remoteSite,h=d.item,!(f>=8));f=++a)e.push('<img class="remote"\nsrc="http://'+k+'/favicon.png"\ndata-slug="'+m+'"\ndata-site="'+k+'"\ntitle="'+k+'">');return e}(),n.push(""+e.join("&nbsp;")+" "+i));if(n)return a.find(".twins").html("<p>"+n.join(", ")+"</p>")}},u=function(a,b){var d,e,l,m,n,p,q;return b.data("data",a.getRawPage()),a.isRemote()&&b.data("site",a.getRemoteSite()),console.log(".page keys ",function(){var a,b,c,d;for(c=$(".page"),d=[],a=0,b=c.length;b>a;a++)p=c[a],d.push($(p).data("key"));return d}()),console.log("lineup keys",o.debugKeys()),x.resolutionContext=a.getContext(),b.empty(),q=["twins","header","story","journal","footer"].map(function(a){return $("<div />").addClass(a).appendTo(b)}),n=q[0],e=q[1],m=q[2],l=q[3],d=q[4],h(e,b,a),j(e,b,a),a.seqItems(function(a,b){var c;return(null!=a?a.type:void 0)&&(null!=a?a.id:void 0)?(c=$('<div class="item '+a.type+'" data-id="'+a.id+'">'),m.append(c),s["do"](c,a,b)):(m.append($('<div><p class="error">Can\'t make sense of story['+i+"]</p></div>")),b())}),a.seqActions(function(a,b){return a.separator&&c(l,a.separator),c(l,a.action),b()}),k(b),f(l),g(d,a)},e=function(a,b){return b.isRemote()?void 0:$("img.favicon",a).error(function(){return s.get("favicon",function(a){return a.create()})})},x.rebuildPage=function(a,b){return a.isLocal()&&b.addClass("local"),a.isRemote()&&b.addClass("remote"),a.isPlugin()&&b.addClass("plugin"),u(a,b),e(b,a),v.setUrl(),n(b),m(b),b},x.buildPage=function(a,b){return b.data("key",o.addPage(a)),x.rebuildPage(a,b)},b.exports=t=x.refresh=function(){var a,b,c,d,e,f,g;return a=$(this),g=a.attr("id").split("_rev"),e=g[0],d=g[1],c={slug:e,rev:d,site:a.data("site")},b=function(){var b,c,d,f,g,h,i,j,k,l;i=$('a[href="/'+e+'.html"]:last').text()||e,f=q(),f.setTitle(i),c=[],l=x.neighborhood;for(h in l)d=l[h],null!=d.sitemap&&(g=y.find(d.sitemap,function(a){return a.slug===e}),null!=g&&c.push({type:"reference",site:h,slug:e,title:g.title||e,text:g.synopsis||""}));if(c.length>0)for(f.addItem({type:"future",text:"We could not find this page in the expected context.",title:i}),f.addItem({type:"paragraph",text:"We did find the page in your current neighborhood."}),j=0,k=c.length;k>j;j++)b=c[j],f.addItem(b);
else f.addItem({type:"future",text:"We could not find this page.",title:i});return x.buildPage(f,a).addClass("ghost")},f=function(b){var c,d,e,f,g;for(x.buildPage(b,a),f=b.getNeighbors(location.host),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(p.registerNeighbor(c));return g},r.get({whenGotten:f,whenNotGotten:b,pageInformation:c})}},{"./addToJournal":3,"./lineup":7,"./neighborhood":8,"./page":9,"./pageHandler":10,"./plugin":12,"./state":17,"./util":19,"./wiki":20,underscore:21}],15:[function(a,b,c){var d;d=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;for(g=b.journal,m=b.title,k=[],j=g.slice(0,++a+1||9e9),o=0,r=j.length;r>o;o++)switch(h=j[o],l=k.map(function(a){return a.id}),h.type){case"create":null!=h.item.title&&(m=h.item.title,k=h.item.story||[]);break;case"add":-1!==(c=l.indexOf(h.after))?k.splice(c+1,0,h.item):k.push(h.item);break;case"edit":-1!==(d=l.indexOf(h.id))?k.splice(d,1,h.item):k.push(h.item);break;case"move":for(f={},p=0,s=k.length;s>p;p++)n=k[p],f[n.id]=n;for(k=[],u=h.order,q=0,t=u.length;t>q;q++)e=u[q],null!=f[e]&&k.push(f[e]);break;case"remove":-1!==(i=l.indexOf(h.id))&&k.splice(i,1)}return{story:k,journal:j,title:m}},c.create=d},{}],16:[function(a,b){var c,d,e,f,g;g=a("./wiki"),f=a("./util"),c=a("./active"),e=a("./page").newPage,d=function(a){var b,d;return b=a.neighborhood,d=function(a){var d,f,h,i,j,k,l,m;for(i=b.search(a),j=i.tally,h=e(),h.setTitle("Search for '"+a+"'"),h.addParagraph("String '"+a+"' found on "+(j.finds||"none")+" of "+(j.pages||"no")+" pages from "+(j.sites||"no")+" sites.\nText matched on "+(j.title||"no")+" titles, "+(j.text||"no")+" paragraphs, and "+(j.slug||"no")+" slugs.\nElapsed time "+j.msec+" milliseconds."),m=i.finds,k=0,l=m.length;l>k;k++)f=m[k],h.addItem({type:"reference",site:f.site,slug:f.page.slug,title:f.page.title,text:f.page.synopsis||""});return d=g.createPage(h.getSlug()).addClass("ghost"),d.appendTo($(".main")),g.buildPage(h,d),c.set($(".page").last())},{performSearch:d}},b.exports=d},{"./active":2,"./page":9,"./util":19,"./wiki":20}],17:[function(a,b){var c,d,e,f,g=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};f=a("./wiki"),c=a("./active"),d=a("./lineup"),b.exports=e={},e.pagesInDom=function(){return $.makeArray($(".page").map(function(a,b){return b.id}))},e.urlPages=function(){var a;return function(){var b,c,d,e;for(d=$(location).attr("pathname").split("/"),e=[],b=0,c=d.length;c>b;b+=2)a=d[b],e.push(a);return e}().slice(1)},e.locsInDom=function(){return $.makeArray($(".page").map(function(a,b){return $(b).data("site")||"view"}))},e.urlLocs=function(){var a,b,c,d,e;for(d=$(location).attr("pathname").split("/").slice(1),e=[],b=0,c=d.length;c>b;b+=2)a=d[b],e.push(a);return e},e.setUrl=function(){var a,b,c,d,f,g;return document.title=null!=(g=$(".page:last").data("data"))?g.title:void 0,history&&history.pushState&&(b=e.locsInDom(),d=e.pagesInDom(),f=function(){var e,f,g;for(g=[],a=e=0,f=d.length;f>e;a=++e)c=d[a],g.push("/"+((null!=b?b[a]:void 0)||"view")+"/"+c);return g}().join(""),f!==$(location).attr("pathname"))?history.pushState(null,null,f):void 0},e.show=function(){var a,b,g,h,i,j,k,l,m,n,o,p,q,r;if(m=e.pagesInDom(),j=e.urlPages(),l=e.locsInDom(),i=e.urlLocs(),location.pathname&&"/"!==location.pathname){for(g=!0,b=n=0,p=m.length;p>n;b=++n)h=m[b],g&&(g=h===j[b])||(k=$(".page:last"),d.removeKey(k.data("key")),k.remove());for(g=!0,b=o=0,q=j.length;q>o;b=++o)h=j[b],g&&(g=h===m[b])||(console.log("push",b,h),f.createPage(h,i[b]).appendTo($(".main")).each(f.refresh));return console.log("a .page keys ",function(){var b,c,d,e;for(d=$(".page"),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push($(a).data("key"));return e}()),console.log("a lineup keys",d.debugKeys()),c.set($(".page").last()),document.title=null!=(r=$(".page:last").data("data"))?r.title:void 0}},e.first=function(){var a,b,c,d,h,i,j,k;for(e.setUrl(),b=e.urlPages(),a=e.urlLocs(),d=e.pagesInDom(),k=[],c=i=0,j=b.length;j>i;c=++i)h=b[c],g.call(d,h)<0&&k.push(""!==h?f.createPage(h,a[c]).appendTo(".main"):void 0);return k}},{"./active":2,"./lineup":7,"./wiki":20}],18:[function(a,b){b.exports=function(a){var b,c,d;return d=a.synopsis,null!=a&&null!=a.story?(b=a.story[0],c=a.story[1],b&&"paragraph"===b.type&&(d||(d=b.text)),c&&"paragraph"===c.type&&(d||(d=c.text)),b&&null!=b.text&&(d||(d=b.text)),c&&null!=c.text&&(d||(d=c.text)),d||(d=null!=a.story&&"A page with "+a.story.length+" items.")):d="A page with no story.",d}},{}],19:[function(a,b){var c,d;d=a("./wiki"),b.exports=d.util=c={},c.symbols={create:"☼",add:"+",edit:"✎",fork:"⚑",move:"↕",remove:"✕"},c.randomByte=function(){return(256*(1+Math.random())|0).toString(16).substring(1)},c.randomBytes=function(a){return function(){var b,d;for(d=[],b=1;a>=1?a>=b:b>=a;a>=1?b++:b--)d.push(c.randomByte());return d}().join("")},c.formatTime=function(a){var b,c,d,e,f;return c=new Date(a>1e10?a:1e3*a),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c.getMonth()],d=c.getHours(),b=12>d?"AM":"PM",d=0===d?12:d>12?d-12:d,e=(c.getMinutes()<10?"0":"")+c.getMinutes(),""+d+":"+e+" "+b+"<br>"+c.getDate()+" "+f+" "+c.getFullYear()},c.formatDate=function(a){var b,c,d,e,f,g,h,i,j;return c=new Date(a),i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][c.getDay()],g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c.getMonth()],d=c.getDate(),j=c.getFullYear(),e=c.getHours(),b=12>e?"AM":"PM",e=0===e?12:e>12?e-12:e,f=(c.getMinutes()<10?"0":"")+c.getMinutes(),h=(c.getSeconds()<10?"0":"")+c.getSeconds(),""+i+" "+g+" "+d+", "+j+"<br>"+e+":"+f+":"+h+" "+b},c.formatElapsedTime=function(a){var b,c,d,e,f,g,h,i;return f=(new Date).getTime()-a,(g=f/1e3)<2?""+Math.floor(f)+" milliseconds ago":(d=g/60)<2?""+Math.floor(g)+" seconds ago":(c=d/60)<2?""+Math.floor(d)+" minutes ago":(b=c/24)<2?""+Math.floor(c)+" hours ago":(h=b/7)<2?""+Math.floor(b)+" days ago":(e=b/31)<2?""+Math.floor(h)+" weeks ago":(i=b/365)<2?""+Math.floor(e)+" months ago":""+Math.floor(i)+" years ago"},c.getSelectionPos=function(a){var b,c,d;return b=a.get(0),document.selection?(b.focus(),d=document.selection.createRange(),d.moveStart("character",-b.value.length),c=d.text.length,{start:c,end:c}):{start:b.selectionStart,end:b.selectionEnd}},c.setCaretPosition=function(a,b){var c,d;return c=a.get(0),null!=c?(c.createTextRange?(d=c.createTextRange(),d.move("character",b),d.select()):c.setSelectionRange(b,b),c.focus()):void 0}},{"./wiki":20}],20:[function(a,b){var c,d,e=[].slice;c=a("./synopsis"),d={createSynopsis:c},d.persona=a("./persona"),d.log=function(){var a;return a=1<=arguments.length?e.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console?console.log:void 0)?console.log.apply(console,a):void 0},d.asSlug=function(a){return a.replace(/\s/g,"-").replace(/[^A-Za-z0-9-]/g,"").toLowerCase()},d.useLocalStorage=function(){return $(".login").length>0},d.resolutionContext=[],d.resolveFrom=function(a,b){d.resolutionContext.push(a);try{return b()}finally{d.resolutionContext.pop()}},d.getData=function(a){var b,c;return a?(b=$(".item").index(a),c=$(".item:lt("+b+")").filter(".chart,.data,.calculator").last(),null!=c?c.data("item").data:{}):(c=$(".chart,.data,.calculator").last(),null!=c?c.data("item").data:{})},d.getDataNodes=function(a){var b,c;return a?(b=$(".item").index(a),c=$(".item:lt("+b+")").filter(".chart,.data,.calculator").toArray().reverse(),$(c)):(c=$(".chart,.data,.calculator").toArray().reverse(),$(c))},d.createPage=function(a,b){var c,d;return b&&"view"!==b&&(d=b),c=$('<div class="page" id="'+a+'">\n  <div class="twins"> <p> </p> </div>\n  <div class="header">\n    <h1> <img class="favicon" src="'+(d?"//"+d:"")+'/favicon.png" height="32px"> '+a+" </h1>\n  </div>\n</div>"),d&&c.data("site",d),c},d.getItem=function(a){return $(a).length>0?$(a).data("item")||$(a).data("staticItem"):void 0},d.resolveLinks=function(a){var b;return b=function(a,b){var c;return c=d.asSlug(b),'<a class="internal" href="/'+c+'.html" data-page-name="'+c+'" title="'+d.resolutionContext.join(" => ")+'">'+b+"</a>"},a.replace(/\[\[([^\]]+)\]\]/gi,b).replace(/\[((http|https|ftp):.*?) (.*?)\]/gi,'<a class="external" target="_blank" href="$1" title="$1" rel="nofollow">$3 <img src="/images/external-link-ltr-icon.png"></a>')},b.exports=d},{"./persona":11,"./synopsis":18}],21:[function(a,b,c){(function(){var a=this,d=a._,e={},f=Array.prototype,g=Object.prototype,h=Function.prototype,i=f.push,j=f.slice,k=f.concat,l=g.toString,m=g.hasOwnProperty,n=f.forEach,o=f.map,p=f.reduce,q=f.reduceRight,r=f.filter,s=f.every,t=f.some,u=f.indexOf,v=f.lastIndexOf,w=Array.isArray,x=Object.keys,y=h.bind,z=function(a){return a instanceof z?a:this instanceof z?void(this._wrapped=a):new z(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=z),c._=z):a._=z,z.VERSION="1.6.0";var A=z.each=z.forEach=function(a,b,c){if(null==a)return a;if(n&&a.forEach===n)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,f=a.length;f>d;d++)if(b.call(c,a[d],d,a)===e)return}else for(var g=z.keys(a),d=0,f=g.length;f>d;d++)if(b.call(c,a[g[d]],g[d],a)===e)return;return a};z.map=z.collect=function(a,b,c){var d=[];return null==a?d:o&&a.map===o?a.map(b,c):(A(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var B="Reduce of empty array with no initial value";z.reduce=z.foldl=z.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),p&&a.reduce===p)return d&&(b=z.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(A(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(B);return c},z.reduceRight=z.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),q&&a.reduceRight===q)return d&&(b=z.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=z.keys(a);f=g.length}if(A(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(B);return c},z.find=z.detect=function(a,b,c){var d;return C(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},z.filter=z.select=function(a,b,c){var d=[];return null==a?d:r&&a.filter===r?a.filter(b,c):(A(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},z.reject=function(a,b,c){return z.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},z.every=z.all=function(a,b,c){b||(b=z.identity);var d=!0;return null==a?d:s&&a.every===s?a.every(b,c):(A(a,function(a,f,g){return(d=d&&b.call(c,a,f,g))?void 0:e}),!!d)};var C=z.some=z.any=function(a,b,c){b||(b=z.identity);var d=!1;return null==a?d:t&&a.some===t?a.some(b,c):(A(a,function(a,f,g){return d||(d=b.call(c,a,f,g))?e:void 0}),!!d)};z.contains=z.include=function(a,b){return null==a?!1:u&&a.indexOf===u?-1!=a.indexOf(b):C(a,function(a){return a===b})},z.invoke=function(a,b){var c=j.call(arguments,2),d=z.isFunction(b);return z.map(a,function(a){return(d?b:a[b]).apply(a,c)})},z.pluck=function(a,b){return z.map(a,z.property(b))},z.where=function(a,b){return z.filter(a,z.matches(b))},z.findWhere=function(a,b){return z.find(a,z.matches(b))},z.max=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-1/0,e=-1/0;return A(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},z.min=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return A(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},z.shuffle=function(a){var b,c=0,d=[];return A(a,function(a){b=z.random(c++),d[c-1]=d[b],d[b]=a}),d},z.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=z.values(a)),a[z.random(a.length-1)]):z.shuffle(a).slice(0,Math.max(0,b))};var D=function(a){return null==a?z.identity:z.isFunction(a)?a:z.property(a)};z.sortBy=function(a,b,c){return b=D(b),z.pluck(z.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var E=function(a){return function(b,c,d){var e={};return c=D(c),A(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};z.groupBy=E(function(a,b,c){z.has(a,b)?a[b].push(c):a[b]=[c]}),z.indexBy=E(function(a,b,c){a[b]=c}),z.countBy=E(function(a,b){z.has(a,b)?a[b]++:a[b]=1}),z.sortedIndex=function(a,b,c,d){c=D(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},z.toArray=function(a){return a?z.isArray(a)?j.call(a):a.length===+a.length?z.map(a,z.identity):z.values(a):[]},z.size=function(a){return null==a?0:a.length===+a.length?a.length:z.keys(a).length},z.first=z.head=z.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:j.call(a,0,b)},z.initial=function(a,b,c){return j.call(a,0,a.length-(null==b||c?1:b))},z.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:j.call(a,Math.max(a.length-b,0))},z.rest=z.tail=z.drop=function(a,b,c){return j.call(a,null==b||c?1:b)},z.compact=function(a){return z.filter(a,z.identity)};var F=function(a,b,c){return b&&z.every(a,z.isArray)?k.apply(c,a):(A(a,function(a){z.isArray(a)||z.isArguments(a)?b?i.apply(c,a):F(a,b,c):c.push(a)}),c)};z.flatten=function(a,b){return F(a,b,[])},z.without=function(a){return z.difference(a,j.call(arguments,1))},z.partition=function(a,b){var c=[],d=[];return A(a,function(a){(b(a)?c:d).push(a)}),[c,d]},z.uniq=z.unique=function(a,b,c,d){z.isFunction(b)&&(d=c,c=b,b=!1);var e=c?z.map(a,c,d):a,f=[],g=[];return A(e,function(c,d){(b?d&&g[g.length-1]===c:z.contains(g,c))||(g.push(c),f.push(a[d]))}),f},z.union=function(){return z.uniq(z.flatten(arguments,!0))},z.intersection=function(a){var b=j.call(arguments,1);return z.filter(z.uniq(a),function(a){return z.every(b,function(b){return z.contains(b,a)})})},z.difference=function(a){var b=k.apply(f,j.call(arguments,1));return z.filter(a,function(a){return!z.contains(b,a)})},z.zip=function(){for(var a=z.max(z.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=z.pluck(arguments,""+c);return b},z.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},z.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=z.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(u&&a.indexOf===u)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},z.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(v&&a.lastIndexOf===v)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},z.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var G=function(){};z.bind=function(a,b){var c,d;if(y&&a.bind===y)return y.apply(a,j.call(arguments,1));if(!z.isFunction(a))throw new TypeError;return c=j.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(j.call(arguments)));G.prototype=a.prototype;var e=new G;G.prototype=null;var f=a.apply(e,c.concat(j.call(arguments)));return Object(f)===f?f:e}},z.partial=function(a){var b=j.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===z&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},z.bindAll=function(a){var b=j.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return A(b,function(b){a[b]=z.bind(a[b],a)}),a},z.memoize=function(a,b){var c={};return b||(b=z.identity),function(){var d=b.apply(this,arguments);return z.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},z.delay=function(a,b){var c=j.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},z.defer=function(a){return z.delay.apply(z,[a,1].concat(j.call(arguments,1)))},z.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:z.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=z.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},z.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=z.now()-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=z.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},z.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},z.wrap=function(a,b){return z.partial(b,a)},z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},z.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},z.keys=function(a){if(!z.isObject(a))return[];if(x)return x(a);var b=[];for(var c in a)z.has(a,c)&&b.push(c);return b},z.values=function(a){for(var b=z.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},z.pairs=function(a){for(var b=z.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},z.invert=function(a){for(var b={},c=z.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},z.functions=z.methods=function(a){var b=[];for(var c in a)z.isFunction(a[c])&&b.push(c);return b.sort()},z.extend=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},z.pick=function(a){var b={},c=k.apply(f,j.call(arguments,1));return A(c,function(c){c in a&&(b[c]=a[c])}),b},z.omit=function(a){var b={},c=k.apply(f,j.call(arguments,1));for(var d in a)z.contains(c,d)||(b[d]=a[d]);return b},z.defaults=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},z.clone=function(a){return z.isObject(a)?z.isArray(a)?a.slice():z.extend({},a):a},z.tap=function(a,b){return b(a),a};var H=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof z&&(a=a._wrapped),b instanceof z&&(b=b._wrapped);var e=l.call(a);if(e!=l.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(z.isFunction(g)&&g instanceof g&&z.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,j=!0;if("[object Array]"==e){if(i=a.length,j=i==b.length)for(;i--&&(j=H(a[i],b[i],c,d)););}else{for(var k in a)if(z.has(a,k)&&(i++,!(j=z.has(b,k)&&H(a[k],b[k],c,d))))break;if(j){for(k in b)if(z.has(b,k)&&!i--)break;j=!i}}return c.pop(),d.pop(),j};z.isEqual=function(a,b){return H(a,b,[],[])},z.isEmpty=function(a){if(null==a)return!0;if(z.isArray(a)||z.isString(a))return 0===a.length;for(var b in a)if(z.has(a,b))return!1;return!0},z.isElement=function(a){return!(!a||1!==a.nodeType)},z.isArray=w||function(a){return"[object Array]"==l.call(a)},z.isObject=function(a){return a===Object(a)},A(["Arguments","Function","String","Number","Date","RegExp"],function(a){z["is"+a]=function(b){return l.call(b)=="[object "+a+"]"}}),z.isArguments(arguments)||(z.isArguments=function(a){return!(!a||!z.has(a,"callee"))}),"function"!=typeof/./&&(z.isFunction=function(a){return"function"==typeof a}),z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},z.isNaN=function(a){return z.isNumber(a)&&a!=+a},z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==l.call(a)},z.isNull=function(a){return null===a},z.isUndefined=function(a){return void 0===a},z.has=function(a,b){return m.call(a,b)},z.noConflict=function(){return a._=d,this},z.identity=function(a){return a},z.constant=function(a){return function(){return a}},z.property=function(a){return function(b){return b[a]}},z.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},z.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},z.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},z.now=Date.now||function(){return(new Date).getTime()};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};I.unescape=z.invert(I.escape);var J={escape:new RegExp("["+z.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+z.keys(I.unescape).join("|")+")","g")};z.each(["escape","unescape"],function(a){z[a]=function(b){return null==b?"":(""+b).replace(J[a],function(b){return I[a][b]})}}),z.result=function(a,b){if(null==a)return void 0;var c=a[b];return z.isFunction(c)?c.call(a):c},z.mixin=function(a){A(z.functions(a),function(b){var c=z[b]=a[b];z.prototype[b]=function(){var a=[this._wrapped];return i.apply(a,arguments),O.call(this,c.apply(z,a))}})};var K=0;z.uniqueId=function(a){var b=++K+"";return a?a+b:b},z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\t|\u2028|\u2029/g;z.template=function(a,b,c){var d;c=z.defaults({},c,z.templateSettings);var e=new RegExp([(c.escape||L).source,(c.interpolate||L).source,(c.evaluate||L).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(N,function(a){return"\\"+M[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,z);var i=function(a){return d.call(this,a,z)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},z.chain=function(a){return z(a).chain()};var O=function(a){return this._chain?z(a).chain():a};z.mixin(z),A(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=f[a];z.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],O.call(this,c)}}),A(["concat","join","slice"],function(a){var b=f[a];z.prototype[a]=function(){return O.call(this,b.apply(this._wrapped,arguments))}}),z.extend(z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return z})}).call(this)},{}]},{},[1]);
//# sourceMappingURL=client.map